image:
  file: .gitpod.Dockerfile # Pastikan file ini ada di root repo

tasks:
  - name: Angular & Cypress Setup
    init: |
      echo "Starting Prebuild..."
      # !! PENTING: Pindah ke direktori project Angular kamu yang benar !!
      cd /workspace/learn-angular-sample/my-app
      echo "Current directory (init): $(pwd)" # Konfirmasi
      echo "Listing files in current directory:"
      ls -la # Pastikan package.json terlihat di sini
      echo "Running npm install in $(pwd)..."
      npm install # Install dependensi dari direktori 'my-app'
      echo "Prebuild finished."
    command: |
      echo "Starting Workspace..."
      # !! PENTING: Pindah ke direktori project lagi !!
      cd /workspace/learn-angular-sample/my-app
      echo "Current directory (command): $(pwd)" # Konfirmasi
      echo "Running ng serve in $(pwd)..."
      # Jalankan Angular dev server di background dari 'my-app'
      npx ng serve --host 0.0.0.0 --disable-host-check &
      # Tunggu hingga port 4200 siap
      gp ports await 4200
      echo "Angular development server is running on port 4200."
      echo "=========================================================="
      echo "To open the Cypress Test Runner, run this in a NEW terminal:"
      # Pastikan user pindah ke direktori yang benar
      echo "cd /workspace/learn-angular-sample/my-app && npx cypress open"
      echo ""
      echo "To run Cypress tests headlessly, run in a NEW terminal:"
      # Pastikan user pindah ke direktori yang benar
      echo "cd /workspace/learn-angular-sample/my-app && npx cypress run"
      echo "=========================================================="
      # gp sync-done setup # Opsional

ports:
  - port: 4200
    onOpen: open-preview
    name: Angular App (my-app) # Nama bisa disesuaikan
    description: Angular Development Server
  - port: 6080
    onOpen: ignore
    name: VNC Interface
  - port: 5900
    onOpen: ignore
    name: VNC Port

vscode:
  extensions:
    - angular.ng-template
    - cypress.io
    - dbaeumer.vscode-eslint
    - esbenp.prettier-vscode
    - ms-azuretools.vscode-docker
